{% extends "layouts/base.html" %}
{% load static %}

{% block title %}Activar Edici贸n - {{ acta.titulo }}{% endblock %}

{% block extrastyle %}
<style>
.warning-container {
    background: linear-gradient(45deg, #ffc107, #e0a800);
    color: #212529;
    padding: 2rem;
    border-radius: 8px;
    margin-bottom: 2rem;
    border: 2px solid #e0a800;
}

.danger-alert {
    background: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
    padding: 1rem;
    border-radius: 5px;
    margin: 1rem 0;
}

.info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
}

.info-item {
    background: white;
    padding: 1rem;
    border-radius: 5px;
    border: 1px solid #dee2e6;
}
</style>
{% endblock %}

{% block content %}
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1><i class="fas fa-exclamation-triangle"></i> Activar Edici贸n (Emergencia)</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="/">Inicio</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'gestion_actas:listado' %}">Gesti贸n de Actas</a></li>
                        <li class="breadcrumb-item"><a href="{% url 'gestion_actas:ver' acta_id=acta.id %}">Ver Acta</a></li>
                        <li class="breadcrumb-item active">Activar Edici贸n</li>
                    </ol>
                </div>
            </div>
        </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
            
            <div class="row">
                <div class="col-lg-8 offset-lg-2">
                    
                    <!-- Advertencia Principal -->
                    <div class="warning-container text-center">
                        <h2><i class="fas fa-exclamation-triangle fa-2x"></i></h2>
                        <h3>锔 ACCIN DE EMERGENCIA 锔</h3>
                        <p class="lead">Est谩s a punto de forzar la reactivaci贸n de la edici贸n de esta acta</p>
                    </div>
                    
                    <!-- Informaci贸n del Acta -->
                    <div class="card">
                        <div class="card-header bg-info">
                            <h4><i class="fas fa-file-alt"></i> Informaci贸n del Acta</h4>
                        </div>
                        <div class="card-body">
                            <div class="info-grid">
                                <div class="info-item">
                                    <strong>T铆tulo:</strong><br>
                                    {{ acta.titulo }}
                                </div>
                                <div class="info-item">
                                    <strong>ID:</strong><br>
                                    #{{ acta.id }}
                                </div>
                                <div class="info-item">
                                    <strong>Estado Actual:</strong><br>
                                    <span class="badge" style="background-color: {{ estado_actual.color }}; color: white;">
                                        {{ estado_actual.nombre }}
                                    </span>
                                </div>
                                <div class="info-item">
                                    <strong>Permite Edici贸n:</strong><br>
                                    {% if estado_actual.permite_edicion %}
                                        <span class="badge badge-success">S铆</span>
                                    {% else %}
                                        <span class="badge badge-danger">No (Por eso necesitas esta funci贸n)</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advertencias -->
                    <div class="card">
                        <div class="card-header bg-warning">
                            <h4><i class="fas fa-exclamation-circle"></i> Consecuencias de esta Acci贸n</h4>
                        </div>
                        <div class="card-body">
                            <div class="danger-alert">
                                <h6><i class="fas fa-times-circle"></i> Lo que va a pasar:</h6>
                                <ul>
                                    <li><strong>Cambio de estado:</strong> El acta pasar谩 a "En Edici贸n/Depuraci贸n"</li>
                                    <li><strong>Interrupci贸n de procesos:</strong> Cualquier revisi贸n activa ser谩 interrumpida</li>
                                    <li><strong>P茅rdida de progreso:</strong> El progreso de revisiones pendientes podr铆a perderse</li>
                                    <li><strong>Registro de auditor铆a:</strong> Esta acci贸n quedar谩 registrada permanentemente</li>
                                </ul>
                            </div>
                            
                            <div class="alert alert-info">
                                <h6><i class="fas fa-info-circle"></i> Despu茅s de la activaci贸n:</h6>
                                <ul>
                                    <li>Podr谩s editar el contenido del acta normalmente</li>
                                    <li>Deber谩s enviar nuevamente a revisi贸n cuando termines</li>
                                    <li>Los revisores ser谩n notificados del cambio si corresponde</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botones de Confirmaci贸n -->
                    <div class="card">
                        <div class="card-footer text-center">
                            <form method="post" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger btn-lg mr-3" onclick="return confirmarActivacion()">
                                    <i class="fas fa-unlock"></i> 
                                    S, ACTIVAR EDICIN
                                </button>
                            </form>
                            
                            <a href="{% url 'gestion_actas:ver' acta_id=acta.id %}" class="btn btn-secondary btn-lg">
                                <i class="fas fa-arrow-left"></i> 
                                Cancelar y Volver
                            </a>
                        </div>
                    </div>
                    
                    <!-- Informaci贸n Adicional -->
                    <div class="alert alert-secondary">
                        <small>
                            <i class="fas fa-user-shield"></i> 
                            <strong>Nota:</strong> Esta funci贸n est谩 disponible solo para superusuarios.
                            Tu acci贸n ser谩 registrada en el sistema de auditor铆a con tu usuario ({{ user.username }}) 
                            y timestamp {{ "now"|date:"d/m/Y H:i" }}.
                        </small>
                    </div>
                    
                </div>
            </div>
            
        </div><!-- /.container-fluid -->
    </section>
    <!-- /.content -->
</div>
<!-- /.content-wrapper -->
{% endblock %}

{% block extra_scripts %}
<script>
function confirmarActivacion() {
    const confirmacion = confirm(
        ' CONFIRMACIN FINAL \n\n' +
        'Esta es tu 煤ltima oportunidad para cancelar.\n\n' +
        'La acci贸n no se puede deshacer autom谩ticamente.\n' +
        'Quedar谩 registrada en el historial del sistema.\n\n' +
        '驴CONFIRMAS que deseas activar la edici贸n de esta acta?'
    );
    
    return confirmacion;
}
</script>
{% endblock %}