{% extends "layouts/base.html" %}
{% load static %}

{% block title %}{{ page_title }}{% endblock title %}

{% block content %}
<div class="content-wrapper">
    <!-- Content Header -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>锔 {{ page_title }}</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    {% for item in breadcrumb %}
                        {% if item.active %}
                            <li class="breadcrumb-item active">{{ item.name }}</li>
                        {% else %}
                            <li class="breadcrumb-item"><a href="{{ item.url }}">{{ item.name }}</a></li>
                        {% endif %}
                    {% endfor %}
                </ol>
            </div>
        </div>
    </div>
</div>

<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-8">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title">{{ form_title }}</h3>
                    </div>
                    
                    <form method="post">
                        {% csrf_token %}
                        <div class="card-body">
                            
                            <!-- Informaci贸n B谩sica -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="{{ form.nombre.id_for_label }}">
                                            Nombre del Proveedor <span class="text-danger">*</span>
                                        </label>
                                        {{ form.nombre }}
                                        {% if form.nombre.errors %}
                                            <div class="text-danger">{{ form.nombre.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="{{ form.tipo.id_for_label }}">
                                            Tipo de Proveedor <span class="text-danger">*</span>
                                        </label>
                                        {{ form.tipo }}
                                        {% if form.tipo.errors %}
                                            <div class="text-danger">{{ form.tipo.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Configuraci贸n de API -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="{{ form.api_key.id_for_label }}">
                                            Clave API <span class="text-danger">*</span>
                                        </label>
                                        {{ form.api_key }}
                                        <small class="form-text text-muted">
                                            La clave API ser谩 encriptada autom谩ticamente.
                                        </small>
                                        {% if form.api_key.errors %}
                                            <div class="text-danger">{{ form.api_key.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="{{ form.modelo.id_for_label }}">
                                            Modelo <span class="text-danger">*</span>
                                        </label>
                                        {{ form.modelo }}
                                        <small class="form-text text-muted">
                                            Ej: gpt-4, claude-3-sonnet, deepseek-chat
                                        </small>
                                        {% if form.modelo.errors %}
                                            <div class="text-danger">{{ form.modelo.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Par谩metros de Generaci贸n -->
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="{{ form.temperatura.id_for_label }}">
                                            Temperatura
                                        </label>
                                        {{ form.temperatura }}
                                        <small class="form-text text-muted">
                                            Creatividad del modelo (0.0 - 1.0)
                                        </small>
                                        {% if form.temperatura.errors %}
                                            <div class="text-danger">{{ form.temperatura.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="{{ form.max_tokens.id_for_label }}">
                                            M谩ximo de Tokens
                                        </label>
                                        {{ form.max_tokens }}
                                        <small class="form-text text-muted">
                                            Longitud m谩xima de respuesta
                                        </small>
                                        {% if form.max_tokens.errors %}
                                            <div class="text-danger">{{ form.max_tokens.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="{{ form.activo.id_for_label }}">
                                            Estado
                                        </label>
                                        <div class="form-check">
                                            {{ form.activo }}
                                            <label class="form-check-label" for="{{ form.activo.id_for_label }}">
                                                Proveedor Activo
                                            </label>
                                        </div>
                                        {% if form.activo.errors %}
                                            <div class="text-danger">{{ form.activo.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Configuraci贸n Adicional -->
                            <div class="form-group">
                                <label for="{{ form.configuracion_adicional.id_for_label }}">
                                    Configuraci贸n Adicional (JSON)
                                </label>
                                {{ form.configuracion_adicional }}
                                <small class="form-text text-muted">
                                    Par谩metros adicionales en formato JSON. Ej: {"top_p": 0.9, "frequency_penalty": 0.1}
                                </small>
                                {% if form.configuracion_adicional.errors %}
                                    <div class="text-danger">{{ form.configuracion_adicional.errors }}</div>
                                {% endif %}
                            </div>

                        </div>
                        
                        <div class="card-footer">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> {{ submit_text }}
                            </button>
                            <a href="{% url 'generador_actas:proveedores_lista' %}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> Cancelar
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="col-md-4">
                <!-- Ayuda sobre tipos de proveedor -->
                <div class="card card-info">
                    <div class="card-header">
                        <h3 class="card-title"> Informaci贸n sobre Proveedores</h3>
                    </div>
                    <div class="card-body">
                        <h6><strong>Tipos de Proveedor:</strong></h6>
                        <ul class="list-unstyled">
                            <li><strong>OpenAI:</strong> GPT-4, GPT-3.5-turbo</li>
                            <li><strong>DeepSeek:</strong> deepseek-chat, deepseek-coder</li>
                            <li><strong>Anthropic:</strong> Claude-3 Sonnet, Claude-3 Haiku</li>
                            <li><strong>Google:</strong> Gemini Pro, Gemini Ultra</li>
                            <li><strong>Ollama:</strong> Modelos locales (Llama, Mistral)</li>
                        </ul>
                        
                        <h6><strong>Par谩metros Recomendados:</strong></h6>
                        <ul class="list-unstyled">
                            <li><strong>Temperatura:</strong> 0.3-0.7 para actas</li>
                            <li><strong>Max Tokens:</strong> 2000-4000 para documentos largos</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Prueba de conexi贸n -->
                <div class="card card-warning">
                    <div class="card-header">
                        <h3 class="card-title"> Prueba de Conexi贸n</h3>
                    </div>
                    <div class="card-body">
                        <p>Despu茅s de crear el proveedor, puedes probar la conexi贸n desde el detalle del proveedor.</p>
                        <button type="button" class="btn btn-warning btn-sm" disabled>
                            <i class="fas fa-flask"></i> Probar API
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-ajustar configuraci贸n seg煤n el tipo de proveedor
    const tipoSelect = document.getElementById('{{ form.tipo.id_for_label }}');
    const modeloInput = document.getElementById('{{ form.modelo.id_for_label }}');
    
    if (tipoSelect && modeloInput) {
        tipoSelect.addEventListener('change', function() {
            const tipo = this.value;
            let modeloSugerido = '';
            
            switch(tipo) {
                case 'openai':
                    modeloSugerido = 'gpt-4';
                    break;
                case 'deepseek':
                    modeloSugerido = 'deepseek-chat';
                    break;
                case 'anthropic':
                    modeloSugerido = 'claude-3-sonnet-20240229';
                    break;
                case 'google':
                    modeloSugerido = 'gemini-pro';
                    break;
                case 'ollama':
                    modeloSugerido = 'llama2';
                    break;
            }
            
            if (modeloSugerido && !modeloInput.value) {
                modeloInput.value = modeloSugerido;
            }
        });
    }
});
</script>

{% endblock content %}