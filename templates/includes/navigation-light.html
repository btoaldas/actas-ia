{% load static %}
  
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      
      <!-- Enlaces públicos destacados - Visible en pantallas grandes -->
      <li class="nav-item d-none d-lg-inline-block">
        <a href="{% url 'portal_ciudadano' %}" class="nav-btn-enhanced nav-btn-portal ml-2" style="margin-top: 4px;">
          <i class="fas fa-scroll"></i> 
          <span class="font-weight-bold">ACTAS PÚBLICAS</span>
        </a>
      </li>
      <li class="nav-item d-none d-lg-inline-block">
        <a href="{% url 'transparencia_index' %}" class="nav-btn-enhanced nav-btn-transparencia ml-2" style="margin-top: 4px;">
          <i class="fas fa-eye"></i> 
          <span class="font-weight-bold">PORTAL TRANSPARENCIA</span>
        </a>
      </li>
      
      <!-- Botón dinámico "Siguiente Paso" -->
      {% if next_step_button.show %}
      <li class="nav-item d-none d-lg-inline-block">
        <a href="{{ next_step_button.url }}" class="nav-btn-enhanced {{ next_step_button.class }} ml-2" style="margin-top: 4px;">
          <i class="{{ next_step_button.icon }}"></i> 
          <span class="font-weight-bold">{{ next_step_button.text }}</span>
        </a>
      </li>
      {% endif %}
      
      <!-- Menú dropdown para pantallas medianas y pequeñas -->
      <li class="nav-item dropdown d-lg-none">
        <a class="nav-link dropdown-toggle btn btn-outline-primary btn-sm ml-2" data-toggle="dropdown" href="#" role="button" aria-expanded="false">
          <i class="fas fa-globe"></i> <span class="d-none d-md-inline">Portales Públicos</span>
        </a>
        <div class="dropdown-menu">
          <a class="dropdown-item nav-btn-enhanced nav-btn-portal" href="{% url 'portal_ciudadano' %}" style="margin: 5px; border-radius: 15px; padding: 12px 15px;">
            <i class="fas fa-scroll"></i> 
            <strong>Actas Públicas</strong>
            <small class="d-block text-white-50">Consulte las actas municipales</small>
          </a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item nav-btn-enhanced nav-btn-transparencia" href="{% url 'transparencia_index' %}" style="margin: 5px; border-radius: 15px; padding: 12px 15px;">
            <i class="fas fa-eye"></i> 
            <strong>Portal Transparencia</strong>
            <small class="d-block text-white-50">Información pública municipal</small>
          </a>
          
          <!-- Botón dinámico "Siguiente Paso" para móviles -->
          {% if next_step_button.show %}
          <div class="dropdown-divider"></div>
          <a class="dropdown-item nav-btn-enhanced {{ next_step_button.class }}" href="{{ next_step_button.url }}" style="margin: 5px; border-radius: 15px; padding: 12px 15px;">
            <i class="{{ next_step_button.icon }}"></i> 
            <strong>{{ next_step_button.text }}</strong>
            <small class="d-block text-white-50">Continuar al siguiente paso</small>
          </a>
          {% endif %}
        </div>
      </li>
      
      {% if request.user.is_authenticated %}
        <!-- Enlaces de usuario autenticado comentados -->
      {% else %}
        <!-- Enlaces de login comentados -->
      {% endif %}
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
      <!-- Indicador visual para usuarios no autenticados -->
      {% if not request.user.is_authenticated %}
      <li class="nav-item d-none d-md-inline-block mr-2">
        <span class="navbar-text">
          <small class="text-muted">
            <i class="fas fa-info-circle"></i> Portal público de información municipal
          </small>
        </span>
      </li>
      {% endif %}
      
      <!-- Navbar Search -->
      <li class="nav-item">
        <a class="nav-link" data-widget="navbar-search" href="#" role="button">
          <i class="fas fa-search"></i>
        </a>
        <div class="navbar-search-block">
          <form class="form-inline" method="get" action="{% url 'portal_ciudadano' %}">
            <div class="input-group input-group-sm">
              <input class="form-control form-control-navbar" type="search" name="search" placeholder="Buscar en actas municipales..." aria-label="Buscar" value="{{ request.GET.search|default:'' }}">
              <div class="input-group-append">
                <button class="btn btn-navbar" type="submit">
                  <i class="fas fa-search"></i>
                </button>
                <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </form>
        </div>
      </li>

      <!-- Messages Dropdown Menu -->
      <li class="nav-item dropdown navbar-eventos">
        <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="far fa-comments"></i>
          <span class="badge badge-danger navbar-badge">{{ ultimos_eventos_sistema|length }}</span>
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          {% if ultimos_eventos_sistema %}
            {% for evento in ultimos_eventos_sistema %}
              <a href="#" class="dropdown-item">
                <!-- Message Start -->
                <div class="media">
                  <div class="media-object mr-3">
                    <i class="{{ evento.icono }}"></i>
                  </div>
                  <div class="media-body">
                    <h3 class="dropdown-item-title">
                      {{ evento.titulo }}
                      {% if evento.tipo == 'error' %}
                        <span class="float-right text-sm text-danger"><i class="fas fa-exclamation-triangle"></i></span>
                      {% elif evento.tipo == 'celery' and 'SUCCESS' in evento.titulo %}
                        <span class="float-right text-sm text-success"><i class="fas fa-check"></i></span>
                      {% endif %}
                    </h3>
                    <p class="text-sm">{{ evento.descripcion }}</p>
                    <p class="text-sm text-muted">
                      <i class="far fa-clock mr-1"></i> {{ evento.tiempo_hace }}
                    </p>
                  </div>
                </div>
                <!-- Message End -->
              </a>
              {% if not forloop.last %}
                <div class="dropdown-divider"></div>
              {% endif %}
            {% endfor %}
          {% else %}
            <div class="no-notificaciones">
              <i class="fas fa-info-circle evento-icono-info"></i>
              <span>No hay eventos recientes</span>
              <small class="d-block text-muted mt-1">El sistema está funcionando normalmente</small>
            </div>
          {% endif %}
          <div class="dropdown-divider"></div>
          <a href="{% url 'auditoria:eventos_tiempo_real' %}" class="dropdown-item dropdown-footer">Ver Todos los Eventos</a>
        </div>
      </li>


      <!-- Notifications Dropdown Menu -->
      <li class="nav-item dropdown">
        <a class="nav-link" data-toggle="dropdown" href="#">
          <i class="far fa-bell"></i>
          <span class="badge badge-warning navbar-badge">{{ ultimas_actas_publicadas|length }}</span>
        </a>
        <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
          <span class="dropdown-item dropdown-header">{{ ultimas_actas_publicadas|length }} Acta{{ ultimas_actas_publicadas|length|pluralize }} Reciente{{ ultimas_actas_publicadas|length|pluralize }}</span>
          <div class="dropdown-divider"></div>
          
          {% if ultimas_actas_publicadas %}
            {% for acta in ultimas_actas_publicadas %}
              <a href="{{ acta.url }}" class="dropdown-item">
                <i class="{{ acta.icono }} mr-2" style="color: {{ acta.color }}"></i>
                <strong>{{ acta.numero_acta }}</strong>
                <p class="text-sm mb-1">{{ acta.titulo|truncatechars:50 }}</p>
                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">
                    <i class="fas fa-calendar mr-1"></i>{{ acta.tipo_sesion }}
                  </small>
                  <small class="text-muted">{{ acta.tiempo_hace }}</small>
                </div>
                <small class="text-info d-block">
                  <i class="fas fa-user mr-1"></i>{{ acta.secretario_nombre }}
                </small>
              </a>
              {% if not forloop.last %}
                <div class="dropdown-divider"></div>
              {% endif %}
            {% endfor %}
          {% else %}
            <div class="dropdown-item text-center text-muted py-3">
              <i class="fas fa-file-alt mr-2 text-muted"></i>
              <small>No hay actas publicadas recientes</small>
            </div>
          {% endif %}
          
          <div class="dropdown-divider"></div>
          <a href="{% url 'portal_ciudadano' %}" class="dropdown-item dropdown-footer">
            <i class="fas fa-eye mr-2"></i>Ver Todas las Actas Públicas
          </a>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-widget="fullscreen" href="#" role="button">
          <i class="fas fa-expand-arrows-alt"></i>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-widget="control-sidebar" data-controlsidebar-slide="true" href="#" role="button">
          <i class="fas fa-th-large"></i>
        </a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- CSS adicional para mejorar la presentación -->
  <link rel="stylesheet" href="{% static 'css/navbar-eventos.css' %}">
  <style>
    /* Estilo para botones de navegación inspirado en floating-btn */
    .nav-btn-enhanced {
      padding: 12px 15px !important;
      margin: 5px !important;
      border-radius: 15px !important;
      text-decoration: none !important;
      font-weight: 600 !important;
      font-size: 13px !important;
      display: flex !important;
      align-items: center !important;
      gap: 8px !important;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.12) !important;
      -webkit-backdrop-filter: blur(8px) !important;
      backdrop-filter: blur(8px) !important;
      border: 1px solid rgba(255, 255, 255, 0.3) !important;
    }

    .nav-btn-enhanced:hover {
      transform: translateY(-2px) scale(1.03) !important;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2) !important;
      text-decoration: none !important;
    }

    .nav-btn-portal {
      background: linear-gradient(135deg, rgba(0, 123, 255, 0.9), rgba(0, 86, 179, 0.9)) !important;
      color: white !important;
    }

    .nav-btn-portal:hover {
      background: linear-gradient(135deg, rgba(0, 123, 255, 1), rgba(0, 86, 179, 1)) !important;
      color: white !important;
    }

    .nav-btn-transparencia {
      background: linear-gradient(135deg, rgba(23, 162, 184, 0.9), rgba(13, 110, 139, 0.9)) !important;
      color: white !important;
    }

    .nav-btn-transparencia:hover {
      background: linear-gradient(135deg, rgba(23, 162, 184, 1), rgba(13, 110, 139, 1)) !important;
      color: white !important;
    }

    /* Animación hover para botones del menú */
    .navbar .btn-primary:hover,
    .navbar .btn-info:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
    }
    
    /* Asegurar que los botones estén alineados */
    .navbar .btn-sm {
      padding: 0.25rem 0.75rem;
      font-size: 0.875rem;
      line-height: 1.5;
      border-radius: 0.2rem;
    }
    
    /* Mejorar el dropdown en móviles */
    @media (max-width: 991px) {
      .navbar .dropdown-menu {
        margin-top: 0.5rem !important;
        border: 2px solid #007bff;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }
      
      .navbar .dropdown-item:hover {
        background-color: #f8f9fa;
        padding-left: 1.5rem;
        transition: all 0.2s ease;
      }
    }
    
    /* Prevenir overflow en pantallas pequeñas */
    @media (max-width: 576px) {
      .navbar-nav {
        flex-wrap: nowrap;
      }
      
      .nav-item {
        flex-shrink: 0;
      }
    }
  </style>