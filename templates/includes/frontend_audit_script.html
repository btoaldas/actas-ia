{% comment %}
============================================================================
Template para incluir sistema de auditor칤a frontend
Uso: {% include 'includes/frontend_audit_script.html' %}
============================================================================
{% endcomment %}

{% load static %}

<!-- Sistema de Auditor칤a Frontend - Actas Municipales -->
<script>
    // Configuraci칩n global para el sistema de auditor칤a
    window.AUDIT_CONFIG = {
        apiEndpoint: '{% url "frontend_logs_api" %}',
        userId: {% if user.is_authenticated %}{{ user.id }}{% else %}null{% endif %},
        sessionId: '{{ request.session.session_key|default:"" }}',
        csrfToken: '{{ csrf_token }}',
        trackingEnabled: {% if user.is_authenticated %}true{% else %}false{% endif %},
        debugMode: {% if debug %}true{% else %}false{% endif %}
    };
    
    // Configurar user ID en el HTML para que el script lo detecte
    {% if user.is_authenticated %}
    document.documentElement.setAttribute('data-user-id', '{{ user.id }}');
    {% endif %}
</script>

<!-- Cargar el script principal de auditor칤a -->
<script src="{% static 'js/frontend-audit-logger.js' %}" defer></script>

<!-- Script de inicializaci칩n espec칤fico para la p치gina actual -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    if (window.frontendLogger) {
        // Log evento de carga de p치gina espec칤fica
        window.frontendLogger.trackCustomEvent('PAGE_LOADED', 'NAVEGACION', {
            page_type: '{{ request.resolver_match.view_name|default:"unknown" }}',
            app_name: '{{ request.resolver_match.app_name|default:"" }}',
            url_name: '{{ request.resolver_match.url_name|default:"" }}',
            template_name: '{{ template_name|default:"" }}',
            user_authenticated: {% if user.is_authenticated %}true{% else %}false{% endif %},
            user_is_staff: {% if user.is_staff %}true{% else %}false{% endif %}
        });
        
        {% if debug %}
        console.log('游댌 Sistema de auditor칤a frontend activado');
        console.log('Usuario:', window.AUDIT_CONFIG.userId);
        console.log('Sesi칩n:', window.AUDIT_CONFIG.sessionId);
        {% endif %}
    }
});
</script>

{% comment %}
Para p치ginas espec칤ficas que requieran tracking especial, 
puedes a침adir scripts adicionales despu칠s de incluir este template:

<script>
// Ejemplo: Tracking espec칤fico para formularios de actas
document.querySelectorAll('form[data-track="acta"]').forEach(form => {
    form.addEventListener('submit', function(e) {
        logCustomEvent('ACTA_FORM_SUBMIT', 'MUNICIPAL', {
            form_type: this.dataset.formType || 'unknown',
            acta_id: this.dataset.actaId || null
        });
    });
});
</script>
{% endcomment %}
