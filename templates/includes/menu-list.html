{% load i18n static admin_adminlte %}

<ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
    <!-- Dashboard Principal (simplificado) -->
    <li class="nav-item">
        <a href="/" class="nav-link {% if 'dashboardv1' in segment %} active {% endif %}">
            <i class="nav-icon fas fa-tachometer-alt"></i>
            <p>📊 Dashboard Principal</p>
        </a>
    </li>

    <!-- Procesamiento de Audio -->
    <li class="nav-item {% if 'audio' in parent %} menu-open {% endif %}">
        <a href="#" class="nav-link {% if 'audio' in parent %} active {% endif %}">
            <i class="nav-icon fas fa-microphone-alt"></i>
            <p>
                🎙️ Proceso de Audio
                <i class="right fas fa-angle-left"></i>
            </p>
        </a>
        <ul class="nav nav-treeview">
            <li class="nav-item">
                <a href="{% url 'audio_processing:centro_audio' %}" class="nav-link {% if 'centro-audio' in segment or 'dashboard' in segment or 'grabar-audio' in segment or 'subir-archivo' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>🎯 Centro de Audio</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'audio_processing:lista_procesamientos' %}" class="nav-link {% if 'lista-procesamientos' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>📋 Lista de Procesos</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'audio_processing:tipos_reunion' %}" class="nav-link {% if 'tipos-reunion' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>⚙️ Tipos de Reunión</p>
                </a>
            </li>
        </ul>
    </li>

    <!-- Transcripción y Diarización -->
    <li class="nav-item {% if 'transcripcion' in parent %} menu-open {% endif %}">
        <a href="#" class="nav-link {% if 'transcripcion' in parent %} active {% endif %}">
            <i class="nav-icon fas fa-comments"></i>
            <p>
                🗣️ Transcripción
                <i class="right fas fa-angle-left"></i>
            </p>
        </a>
        <ul class="nav nav-treeview">
            <li class="nav-item">
                <a href="{% url 'transcripcion:audios_listos' %}" class="nav-link {% if 'audios-listos' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>🎵 Audios Listos para Transcribir</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'transcripcion:lista' %}" class="nav-link {% if 'lista' in segment or 'lista-transcripciones' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>📋 Lista de Transcripciones</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link {% if 'configuracion' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>⚙️ Configuración</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="#" class="nav-link {% if 'estadisticas' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>📊 Estadísticas</p>
                </a>
            </li>
        </ul>
    </li>

    <!-- Gestión de Actas (simplificado) -->
    <li class="nav-item {% if 'actas' in parent %} menu-open {% endif %}">
        <a href="#" class="nav-link {% if 'actas' in parent %} active {% endif %}">
            <i class="nav-icon fas fa-file-alt"></i>
            <p>
                📋 Gestión de Actas
                <i class="right fas fa-angle-left"></i>
            </p>
        </a>
        <ul class="nav nav-treeview">
            <li class="nav-item">
                <a href="{% url 'actas_listado' %}" class="nav-link {% if 'dynamic_dt' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>📄 Listado de Actas</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'actas_nueva' %}" class="nav-link {% if 'file_manager' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>📂 Nueva Acta</p>
                </a>
            </li>
        </ul>
    </li>

    <!-- Procesamiento con IA (simplificado) -->
    <li class="nav-item {% if 'ia_procesamiento' in parent %} menu-open {% endif %}">
        <a href="#" class="nav-link {% if 'ia_procesamiento' in parent %} active {% endif %}">
            <i class="nav-icon fas fa-robot"></i>
            <p>
                🤖 Procesamiento IA
                <i class="right fas fa-angle-left"></i>
            </p>
        </a>
        <ul class="nav nav-treeview">
            <li class="nav-item">
                <a href="{% url 'audio_processing:centro_audio' %}" class="nav-link {% if 'audio_processing' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>🎤 Transcripción de Audio</p>
                </a>
            </li>
        </ul>
    </li>

    <!-- Eventos Municipales -->
    <li class="nav-item {% if 'eventos' in parent %} menu-open {% endif %}">
        <a href="#" class="nav-link {% if 'eventos' in parent %} active {% endif %}">
            <i class="nav-icon fas fa-calendar-alt"></i>
            <p>
                📅 Eventos
                <i class="right fas fa-angle-left"></i>
            </p>
        </a>
        <ul class="nav nav-treeview">
            <li class="nav-item">
                <a href="{% url 'eventos_calendario' %}" class="nav-link {% if 'eventos_calendario' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>📅 Calendario</p>
                </a>
            </li>
            {% if user.is_authenticated %}
            <li class="nav-item">
                <a href="{% url 'eventos_nuevo' %}" class="nav-link {% if 'eventos_nuevo' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>➕ Añadir Evento</p>
                </a>
            </li>
            {% endif %}
            <li class="nav-item">
                <a href="{% url 'eventos_calendario' %}?tipo=sesion_concejo" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>🏛️ Sesiones de Concejo</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'eventos_calendario' %}?tipo=reunion_publica" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>👥 Reuniones Públicas</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'eventos_calendario' %}?tipo=audiencia_publica" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>🎤 Audiencias Públicas</p>
                </a>
            </li>
        </ul>
    </li>

    <!-- Auditoría y Seguridad -->
    <li class="nav-item {% if 'auditoria' in parent %} menu-open {% endif %}">
        <a href="#" class="nav-link {% if 'auditoria' in parent %} active {% endif %}">
            <i class="nav-icon fas fa-shield-alt"></i>
            <p>
                🛡️ Auditoría & Seguridad
                <i class="right fas fa-angle-left"></i>
            </p>
        </a>
        <ul class="nav nav-treeview">
            <li class="nav-item">
                <a href="{% url 'auditoria:dashboard' %}" class="nav-link {% if 'dashboard' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>📊 Dashboard de Auditoría</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'auditoria:logs_sistema' %}" class="nav-link {% if 'logs-sistema' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>📋 Logs del Sistema</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'auditoria:logs_navegacion' %}" class="nav-link {% if 'logs-navegacion' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>🔍 Logs de Navegación</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'auditoria:auditoria_cambios' %}" class="nav-link {% if 'auditoria-cambios' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>📝 Auditoría de Cambios</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'auditoria:debug_session' %}" class="nav-link {% if 'debug' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>🔧 Debug Sesiones</p>
                </a>
            </li>
            <li class="nav-item">
                <a href="{% url 'auditoria:debug_all_sessions' %}" class="nav-link {% if 'debug-all' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>🔍 Debug Todas las Sesiones</p>
                </a>
            </li>
        </ul>
    </li>

    {% if request.user.is_superuser %}
    <!-- Administración del Sistema -->
    <li class="nav-item {% if 'sistema' in parent %} menu-open {% endif %}">
        <a href="#" class="nav-link {% if 'sistema' in parent %} active {% endif %}">
            <i class="nav-icon fas fa-cogs"></i>
            <p>
                ⚙️ Sistema
                <i class="right fas fa-angle-left"></i>
            </p>
        </a>
        <ul class="nav nav-treeview">
            <li class="nav-item">
                <a href="{% url 'admin:index' %}" class="nav-link {% if 'admin' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>🔐 Panel de Administración</p>
                </a>
            </li>
            
            <!-- Configuraciones del Sistema IA -->
            <li class="nav-item {% if 'config-system' in segment %} menu-open {% endif %}">
                <a href="{% url 'config_system:dashboard' %}" class="nav-link {% if 'config-system' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>
                        🤖 Configuraciones del Sistema
                        <i class="right fas fa-angle-left"></i>
                    </p>
                </a>
                <ul class="nav nav-treeview">
                    <li class="nav-item">
                        <a href="{% url 'config_system:dashboard' %}" class="nav-link {% if 'dashboard' in segment %} active {% endif %}">
                            <i class="far fa-dot-circle nav-icon"></i>
                            <p>📊 Dashboard Config</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'config_system:ia_list' %}" class="nav-link {% if 'ia' in segment %} active {% endif %}">
                            <i class="far fa-dot-circle nav-icon"></i>
                            <p>🧠 Config IA</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'config_system:whisper_list' %}" class="nav-link {% if 'whisper' in segment %} active {% endif %}">
                            <i class="far fa-dot-circle nav-icon"></i>
                            <p>🎤 Config Whisper</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'config_system:smtp_list' %}" class="nav-link {% if 'smtp' in segment %} active {% endif %}">
                            <i class="far fa-dot-circle nav-icon"></i>
                            <p>📧 Config SMTP</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'config_system:email_config' %}" class="nav-link {% if 'email-config' in segment %} active {% endif %}">
                            <i class="far fa-dot-circle nav-icon"></i>
                            <p>✉️ Config Emails</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'config_system:email_logs' %}" class="nav-link {% if 'email-logs' in segment %} active {% endif %}">
                            <i class="far fa-dot-circle nav-icon"></i>
                            <p>📋 Logs Email</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{% url 'config_system:usuarios_list' %}" class="nav-link {% if 'usuarios' in segment %} active {% endif %}">
                            <i class="far fa-dot-circle nav-icon"></i>
                            <p>👥 Usuarios Config</p>
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
    </li>
    {% endif %}

    <!-- OTROS - Sección reorganizada -->
    <li class="nav-header">OTROS</li>
    
    <!-- Elementos reorganizados -->
    <li class="nav-item {% if 'otros' in parent %} menu-open {% endif %}">
        <a href="#" class="nav-link {% if 'otros' in parent %} active {% endif %}">
            <i class="nav-icon fas fa-th-large"></i>
            <p>
                📦 Herramientas Adicionales
                <i class="right fas fa-angle-left"></i>
            </p>
        </a>
        <ul class="nav nav-treeview">
            <!-- Estadísticas Avanzadas (sin renombrar) -->
            <li class="nav-item">
                <a href="{% url 'dashboardv2' %}" class="nav-link {% if 'dashboardv2' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Estadísticas Avanzadas</p>
                </a>
            </li>
            <!-- Métricas de IA (sin renombrar) -->
            <li class="nav-item">
                <a href="{% url 'dashboardv3' %}" class="nav-link {% if 'dashboardv3' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Métricas de IA</p>
                </a>
            </li>
            <!-- Buscar Actas → widgets -->
            <li class="nav-item">
                <a href="{% url 'widgets' %}" class="nav-link {% if 'widgets' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>widgets</p>
                </a>
            </li>
            <!-- Estadísticas de Actas → chartjs -->
            <li class="nav-item">
                <a href="{% url 'chartjs' %}" class="nav-link {% if 'chartjs' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>chartjs</p>
                </a>
            </li>
            <!-- Procesamiento Automático → tasks -->
            <li class="nav-item">
                <a href="{% url 'tasks' %}" class="nav-link {% if 'tasks' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>tasks</p>
                </a>
            </li>
            <!-- Configurar IA → Perfil -->
            <li class="nav-item">
                <a href="{% url 'profile' %}" class="nav-link {% if 'profile' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>Perfil</p>
                </a>
            </li>
            <!-- Dashboard General → inicio -->
            <li class="nav-item">
                <a href="/" class="nav-link {% if 'dashboardv1' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>inicio</p>
                </a>
            </li>
            <!-- Gestión de Datos → panel -->
            <li class="nav-item">
                <a href="{% url 'table_simple' %}" class="nav-link {% if 'table_simple' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>panel</p>
                </a>
            </li>
            <!-- Tablas Dinámicas → monitoring -->
            <li class="nav-item">
                <a href="{% url 'table_data' %}" class="nav-link {% if 'table_data' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>monitoring</p>
                </a>
            </li>
            <!-- Herramientas Rápidas → batch -->
            <li class="nav-item">
                <a href="{% url 'table_jsgrid' %}" class="nav-link {% if 'table_jsgrid' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>batch</p>
                </a>
            </li>
            <!-- Análisis de Texto → text-analysis -->
            <li class="nav-item">
                <a href="{% url 'actas_analisis_texto' %}" class="nav-link {% if 'dynamic_api' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>text-analysis</p>
                </a>
            </li>
            <!-- Escaneo de Documentos → auto-classification -->
            <li class="nav-item">
                <a href="{% url 'top_navigation' %}" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>auto-classification</p>
                </a>
            </li>
            <!-- OCR - Reconocimiento → data-extraction -->
            <li class="nav-item">
                <a href="{% url 'top_nav_sidebar' %}" class="nav-link">
                    <i class="far fa-circle nav-icon"></i>
                    <p>data-extraction</p>
                </a>
            </li>
            <!-- Validación de Datos → version-control -->
            <li class="nav-item">
                <a href="{% url 'boxed' %}" class="nav-link {% if 'boxed_layout' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>version-control</p>
                </a>
            </li>
            <!-- Archivo Digital → backup -->
            <li class="nav-item">
                <a href="{% url 'fixed_sidebar' %}" class="nav-link {% if 'fixed_sidebar' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>backup</p>
                </a>
            </li>
            <!-- Portal de Transparencia → network -->
            <li class="nav-item">
                <a href="{% url 'fixed_navbar' %}" class="nav-link {% if 'fixed_navbar' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>network</p>
                </a>
            </li>
            <!-- Galería de Documentos → file-manager -->
            <li class="nav-item">
                <a href="{% url 'examples_gallery' %}" class="nav-link {% if 'examples_gallery' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>file-manager</p>
                </a>
            </li>
            <!-- Gestión de Usuarios → code-editor -->
            <li class="nav-item">
                <a href="{% url 'form_general' %}" class="nav-link {% if 'form_general' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>code-editor</p>
                </a>
            </li>
            <!-- Configuración Municipal → web-terminal -->
            <li class="nav-item">
                <a href="{% url 'form_advanced' %}" class="nav-link {% if 'form_advanced' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>web-terminal</p>
                </a>
            </li>
            <!-- Manual de Usuario → tech-docs -->
            <li class="nav-item">
                <a href="{% url 'examples_invoice' %}" class="nav-link {% if 'examples_invoice' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>tech-docs</p>
                </a>
            </li>
            <!-- APIs Públicas → api-docs -->
            <li class="nav-item">
                <a href="#" class="nav-link {% if 'layout_rtl' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>api-docs</p>
                </a>
            </li>
            <!-- KPIs de Eficiencia → dev-tools -->
            <li class="nav-item">
                <a href="{% url 'uplot' %}" class="nav-link {% if 'uplot' in segment %} active {% endif %}">
                    <i class="far fa-circle nav-icon"></i>
                    <p>dev-tools</p>
                </a>
            </li>
        </ul>
    </li>

    <!-- Separador -->
    <li class="nav-header">ACCESO RÁPIDO</li>
    
    <!-- Accesos Rápidos -->
    <li class="nav-item">
        <a href="{% url 'actas_nueva' %}" class="nav-link">
            <i class="nav-icon fas fa-plus text-success"></i>
            <p>Nueva Acta</p>
        </a>
    </li>
    
    <li class="nav-item">
        <a href="{% url 'actas_listado' %}" class="nav-link">
            <i class="nav-icon fas fa-search text-primary"></i>
            <p>Buscar Actas</p>
        </a>
    </li>
    
    <li class="nav-item">
        <a href="{% url 'chartjs' %}" class="nav-link">
            <i class="nav-icon fas fa-chart-bar text-warning"></i>
            <p>Estadísticas</p>
        </a>
    </li>

    <!-- Autenticación -->
    {% if request.user.is_authenticated %}
    <li class="nav-item">
        <a href="{% url 'logout' %}" class="nav-link">
            <i class="fa fa-sign-out-alt nav-icon"></i>
            <p>Logout</p>
        </a>
    </li>
    {% else %}
    <li class="nav-item">
        <a href="{% url 'login' %}" class="nav-link">
            <i class="fa fa-sign-in-alt nav-icon"></i>
            <p>Login</p>
        </a>
    </li>
    <li class="nav-item">
        <a href="{% url 'register' %}" class="nav-link">
            <i class="fa fa-user-plus nav-icon"></i>
            <p>Register</p>
        </a>
    </li>        
    {% endif %} 
    
    <li class="nav-item">
        <a target="_blank" href="https://puyo.gob.ec/soporte/" class="nav-link">
            <i class="fa fa-download text-primary nav-icon"></i>
            <p>Soporte</p>
        </a>
    </li>

</ul>
